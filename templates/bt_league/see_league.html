{% extends '../base.html' %}

{% load static %}

{% block favicon %}
    <link rel="shortcut icon" href="{% static 'images/bt.ico' %}" />
{% endblock %}

{% block title %}{{ torneio.nome }} ({{ torneio.data }}){% endblock %}

{% block content %}
<style>
    body {
        position: absolute;
        height: 100%;
        width: 100%;
    }

    td.winner, span.winner {
        font-weight: bold;
        color: #00a50b !important;
    }

    td.loser, span.loser {
        color: #ff2323 !important;
    }

    body.dark-mode {
        background-color: #1a1a1a;
        color: #ffffff;
    }

    body.dark-mode .table-striped tr:nth-of-type(odd) *,
    body.dark-mode .table-striped tr:nth-of-type(even) * {
        background-color: #3b3b3b !important;
        color: #ffffff;
    }

    body.dark-mode .table-striped th {
        background-color: #333333 !important;
        color: #ffffff;
    }

    body.dark-mode .form-control {
        background-color: #2d2d2d;
        border-color: #404040;
        color: #ffffff;
    }

    body.dark-mode .text-muted,
    body.dark-mode input::placeholder {
        color: #999999 !important;
    }

    .theme-switch {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
    }

    .theme-switch button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        background-color: #969696;
        transition: all 0.3s;
    }

    .theme-switch button:hover {
        filter: brightness(1.2);
        background-color: #636363;
    }

    #reload {
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        opacity: 0.7;
        z-index: 1000;
        font-size: 20pt;
    }
</style>

<div class="theme-switch">
    <button id="themeToggle" class="btn" title="Alternar modo escuro">üåô</button>
</div>

<div class="container h-100 d-flex flex-column justify-content-between">
    <div class="pt-5">
        {% if torneio.ativo %}
            <h1 class="text-center">{{ torneio.nome }} ({{ torneio.data }})</h1>

            <button
                class="btn btn-primary btn-sm"
                id="reload"
                title="Recarregar"
                onclick="location.reload();"
            >
                <svg viewBox="0 0 118.04 122.88" fill="white">
                    <path d="M16.08,59.26A8,8,0,0,1,0,59.26a59,59,0,0,1,97.13-45V8a8,8,0,1,1,16.08,0V33.35a8,8,0,0,1-8,8L80.82,43.62a8,8,0,1,1-1.44-15.95l8-.73A43,43,0,0,0,16.08,59.26Zm22.77,19.6a8,8,0,0,1,1.44,16l-10.08.91A42.95,42.95,0,0,0,102,63.86a8,8,0,0,1,16.08,0A59,59,0,0,1,22.3,110v4.18a8,8,0,0,1-16.08,0V89.14h0a8,8,0,0,1,7.29-8l25.31-2.3Z"/>
                </svg>
            </button>
        {% else %}
            <h1 class="text-center"><s>{{ torneio.nome }} ({{ torneio.data }})</s></h1>
            <h2 class="text-center"><s>FINALIZADO</s></h2>
        {% endif %}

        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-6">
                    <h4 class="mt-3 mb-1 text-center">
                        Jogos: {{ n_jogos }}
                        {% if jogos_restantes > 0 %}
                            / Pendente: {{ jogos_restantes }}
                        {% endif %}
                    </h4>

                    <div class="input-group mt-4 mb-1">
                        <input
                            id="search-input"
                            type="text"
                            class="form-control"
                            placeholder="Buscar jogador..."
                            aria-label="Buscar jogador..."
                        />
                    </div>

                    <div class="card-body table-responsive">
                        <table class="table table-striped text-center mb-4" id="games-table">
                            <thead>
                                <tr>
                                    <th>Quadra</th>
                                    <th>Dupla 1</th>
                                    <th>Placar</th>
                                    <th>Dupla 2</th>
                                    <th></th>
                                </tr>
                            </thead>

                            <tbody id="tableBody" style="vertical-align: middle;">
                                {% for jogo in jogos %}
                                <tr>
                                    <td>{{ jogo.quadra }}</td>

                                    <td class="{% if jogo.concluido and jogo.placar_dupla1 > jogo.placar_dupla2 %}winner{% elif jogo.concluido and jogo.placar_dupla1 < jogo.placar_dupla2 %}loser{% endif %}">
                                        {{ jogo.dupla1_jogador1.short_name }}
                                        <br/>
                                        {{ jogo.dupla1_jogador2.short_name }}
                                    </td>

                                    <td>{{ jogo.placar_dupla1|default_if_none:'-' }} x {{ jogo.placar_dupla2|default_if_none:'-' }}</td>

                                    <td class="{% if jogo.concluido and jogo.placar_dupla2 > jogo.placar_dupla1 %}winner{% elif jogo.concluido and jogo.placar_dupla2 < jogo.placar_dupla1 %}loser{% endif %}">
                                        {{ jogo.dupla2_jogador1.short_name }}
                                        <br/>
                                        {{ jogo.dupla2_jogador2.short_name }}
                                    </td>

                                    <td>
                                        {% if jogo.concluido %}
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#00a50b" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                            </svg>
                                        {% else %}
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle" viewBox="0 0 16 16">
                                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                            </svg>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <hr class="d-lg-none"/>
                </div>

                <div class="col-12 col-lg-6">
                    <h4 class="mt-3 mb-2 text-center">Ranking</h4>
                    <div class="mt-4 card-body table-responsive">
                        <table class="table table-striped text-center mb-4">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nome</th>
                                    <th>V</th>
                                    <th>S</th>
                                    <th>P</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for item in ranking %}
                                <tr>
                                    <td>{{ item.posicao }}¬∫</td>
                                    <td>{{ item.jogador.nome }}</td>
                                    <td>{{ item.vitorias }}</td>
                                    <td>{{ item.saldo }}</td>
                                    <td>{{ item.pontos }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="w-100 p-5 text-center">
        <span class="text-muted">
            Feito por <a href="https://andrearruda-links.vercel.app/" target="_blank">ALCA Inova√ß√µes Tecnol√≥gicas</a>
        </span>
    </footer>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const darkMode = localStorage.getItem('darkMode') === 'true';

        if (darkMode) {
            body.classList.add('dark-mode');
            updateThemeIcon(true);
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            updateThemeIcon(isDark);
        });

        function updateThemeIcon(isDark) {
            themeToggle.innerHTML = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        const searchInput = document.getElementById('search-input')
        searchInput.addEventListener('keyup', function() {
            const searchTerm = searchInput.value.toLowerCase()
            const tableRows = document.querySelectorAll('#tableBody tr')

            tableRows.forEach(function(row) {
                const name = row.cells[1].textContent.toLowerCase() + row.cells[3].textContent.toLowerCase()
                if (name.includes(searchTerm)) {
                    row.style.display = ''
                } else {
                    row.style.display = 'none'
                }
            })
        })
    })
</script>
{% endblock %}